# 11장 클라이언트 식별과 쿠키

모든 HTTP 통신은 무상태(Stateless) 이다.

사용자 맞춤 정보 추천과 같은 특정 사용자를 지정해서 무언가를 해야 할 때
사용자 정보가 필요한데 HTTP는 상태를 저장하지 않기 때문에 이를 식별할 수 있는 수단이 필요하다.

## 사용자 식별 관련 정보를 전달하는 HTTP 헤더들

- From: 사용자의 이메일 주소
- User-Agent: 사용자의 브라우저 정보
- Referer: 현재 요청을 보낸 문서의 URI
- Authorization: 사용자 이름과 비밀번호

## 클라이언트 IP 주소

클라이언트 IP 주소로 사용자를 식별하는 방법은 다음과 같은 단점들을 가진다.

- ip 는 사용자가 아닌 사용자하는 컴퓨터를 가리킨다. 하나의 컴퓨터에 사용자가 여러명이면 특정하기 힘듬.
- 많은 isp들은 동적ip를 할당하기 때문에 사용자를 ip로 식별하기 힘들다.
- 보안상의 이유로 nat 뒤에 실제 ip를 숨기기 때문에 실제 ip를 알 수 없다.
- 프록시 서버를 사용하면 실제 ip를 알 수 없다.

## 쿠키

쿠키는 사용자를 식별하고 세션을 유지하는 방식 중에서 가장 대중적인 기술이다.

### 쿠키의 타입

쿠키는 세션 쿠키(session cookie)와 지속 쿠키(persistent cookie)로 나뉜다.
둘의 차이점은 파기되는 시점뿐이며, Discard 파라미터가 설정되어 있거나, Expires 또는 Max-Age 파라미터가 설정되어 있지 않으면 세션 쿠키이다.

- 세션쿠키는 브라우저를 닫으면 날아가는 휘발성
- 지속쿠키는 디스크에 저장되며 브라우저를 닫거나 컴퓨터를 재부팅해도 남아있음

각 브라우저별로 다른 방식으로 쿠키를 저장한다.

### Domain 속성

쿠키는 사이트(도메인)별로 다르게 저장되며 Set-Cookie 응답 헤더에 domain 속성을 지정해서 어떤 사이트가 그 쿠키를 읽을 수 있는지 제어할 수 있다.

### Path 속성

웹사이트 일부에만 쿠키를 적용할 수도 있다.
url 경로의 앞부분을 가리키는 path 속성을 사용해서 특정 경로에 속하는 페이지에만 쿠키를 전달할 수도 있다.

### 쿠키 구성 요소

Set-Cookie 헤더는 이름과 값을 가져야 하며 쿠키옵션속성들은 세미콜론으로 이어서 기술한다.

```
Set-Cookie: foo=bar; Expires=Wed, 09 Jun 2021 10:18:14 GMT; Domain=example.com; Path=/; Secure; HttpOnly
```

## 쿠키를 왜 쓸까?

- 쿠키는 기본적으로 클라이언트에 저장하는 정보
- id, 인증 정보와 같은 사용자 정보 저장 및 유지
- 장바구니, 3일동안 보지않기 등 과 같은 개인화 정보 저장 및 유지
- 사용자의 행동을 기록하고 분석하는 추적기능

## 쿠키의 단점?

- 클라이언트에 저장되기 때문에 조작 및 탈취가 가능하므로 보안에 취약
- 웹브라우저에 쿠키 거부 기능이 있기 때문에 거부옵션을 킨 사용자라면 웹사이트의 기능을 온전히 이용하지 못함.

## session

쿠키의 이런 단점을 보완하기 위해 세션과 함께 사용한다.
클라이언트에 대응되는 고유한 세션id를 생성해서 클라이언트에게 전달하면
클라이언트는 쿠키에 세션id를 저장하고 서버에 요청할 때마다 세션id를 전달한다.
서버에서는 세션스토리이제 저장된 세션id와 요청으로 넘겨받은 세션id를 비교해서 사용자를 식별한다.

### 세션 단점

결국 인증된 사용자의 HTTP을 탈취하게 되면 보안이 뚫리는건 마찬가지이다.
해결법으로는 HTTPS를 쓰면된다.

<br>

# 12장 기본 인증
