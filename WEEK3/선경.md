-----

5. 웹 서버

-----

### 웹서버란
클라이언트로부터 HTTP 요청을 받아들이고 요청된 웹 페이지나 리소스를 제공하는 컴퓨터 프로그램이다.  
일반적으로 인터넷이나 로컬 네트워크에 연결된 컴퓨터에 설치되어 있으며  
클라이언트의 요청을 처리하기 위해 필요한 네트워크 연결과 데이터 전송 등의 기능을 제공한다.  


-----

7. 캐시

-----

### 캐시 등장 배경
↓ 이탈리아 경제학자 빌프레도 파레토  

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FptWo4%2FbtraiwIPZDq%2F9fxCqArcEt8X5iZHPregC1%2Fimg.jpg)

파레토는  
이탈리아 상위 20%의 인구는 80%의 부를 소유하고 있다.  
백화점의 20%의 VIP 고객의 지출이 백화점에서 나오는 전체 매출 80%를 차지한다.  
상위소득 20%의 국민이 전체 국가 세금의 80%를 차지한다.  
많이 쓰이는 단어 20%가 언어 사용빈도의 80%를 차지한다.  
와 같은 반복되는 규칙을 발견하게 되고,  

이것을 **파레토의 법칙** 이라고 부르게 된다.  

![](https://t1.daumcdn.net/cfile/tistory/253FF54C584EAA8B0F)

마찬가지로 프로그래밍에서도 자주 반복되는 데이터들이 있는데  
이러한 데이터들에 빠르게 접근한다면 성능이 향상될 것이라고 생각하여  
탄생하게 된 것이 **캐시**이다.


### 캐시란
간단하게 말하면 자주 사용하는 데이터나 값을 미리 복사해 놓는 임시 장소이다.  
캐시를 사용하게 되면 이후에 같은 데이터나 계산 결과를 요청할 때 더 빠르게 처리할 수 있어  
성능 향상에 도움이 된다.  

- 불필요한 데이터 전송을 줄여 네트워크 비용을 줄여준다.  
- 네트워크 병목을 줄여준다. 대역폭을 늘리지 않고도 페이지를 빠르게 불러올 수 있다.
- 원 서버에 대한 요청을 줄여 서버 부하를 줄이고 더 빠르게 응답할 수 있다.
- 거리로 인한 지연을 줄여준다.

#### 전송량 문제
복수의 클라이언트가 자주 사용되는 원 서버 페이지에 접근할 때  
서버는 같은 문서를 클라이언트에게 각각 한번씩 전송하게 되는데  
중복되는 바이트들이 네트워크를 통해 이동하기 때문에  
네트워크의 대역폭을 잡아먹고 전송을 느리게 만들어 웹서버에 부하를 주게 된다.

#### 거리 문제
![](https://www.jh-blog-js.com/static/df14a3c13a3c155f50d6b022eb7914ad/7d769/pic27.png)  

데이터 요청과 응답은 인터넷 상의 여러 노드를 거치기 때문에  
클라이언트와 데이터를 제공하는 서버 사이의 거리가 멀어질수록  
데이터 전송 속도는 느려질 수 있다.  

대역폭이 충분한 고속 인터넷 환경에서도 충분히 발생할 수 있으며,  
원격 지역이나 해외 등 지리적으로 먼 지역에서 데이터를 요청할때 더 심해진다.

#### 해결방법
클라이언트와 서버 사이에 캐시 서버를 두어 이전에 요청했던 데이터들을 저장해두고  
동일한 요청이 들어올 때마다 저장해둔 데이터를 반환해주면  
캐시 서버에서 데이터를 빠르게 제공할 수 있기 때문에  
속도 개선, 대역폭 절약, 서버 부하 감소 효과를 볼 수 있다.

- 캐시 서버 배치 :  
  캐시 서버를 클라이언트와 서버 사이의 중간 지점에 배치하여 데이터 요청과 응답 시간을 줄일 수 있다.  
- 프록시 서버 사용 :  
  프록시 서버를 이용하여 캐시된 데이터를 클라이언트에게 전송함으로써,  
  클라이언트와 캐시 서버 간의 거리를 줄일 수 있다.
- CDN 사용 :  
  CDN을 사용하여 데이터를 캐시 서버에 저장하고 먼 지역에서 데이터를 요청할 경우  
  캐시 서버에서 데이터를 빠르게 가져와 전송 속도를 개선할 수 있다.
- 캐시 유효 기간 설정 :  
  캐시 서버에 저장된 데이터의 유효 기간을 설정하여 일정 시간이 지난 데이터는  
  자동으로 삭제되도록 한다. 캐시에 저장된 오래된 데이터를 사용하지 않아도 돼서  
  캐시의 효율성을 높인다.
- 캐시 용량 관리 :  
  캐시 서버에 저장되는 데이터의 크기와 용량을 관리하여 불필요한 데이터를 삭제하고  
  적절한 용량을 유지한다.


### 적중과 부적중
클라이언트는 응답의 Date 헤더나 Age 헤더를 통해 응답이 캐시로부터 온 것인지  
서버로부터 온 것인지 구분할 수 있다.

#### 적중(Hit)
클라이언트가 요청한 데이터가 캐시에 존재하여 캐시에서 바로 응답을 받는 경우를 말한다.  
이 경우 데이터를 가져오기 위한 원래의 요청을 보내지 않아 응답 시간이 빠르고, 서버의 부하를 줄일 수 있다.

#### 부적중(Miss)
클라이언트가 요청한 데이터가 캐시에 존재하지 않아 원래의 요청을 서버로 보내야 하는 경우를 말한다.  
이 경우 캐시 서버는 원래의 요청을 서버에 보내고 응답을 받아 클라이언트에게 전달해야 하기 때문에  
요청과 응답 시간이 적중보다 오래 걸리게 된다.

#### 적중률(Hit Rate)
캐시에서 찾은 데이터의 비율로, 적중률이 높을수록 캐시 효율이 높아진다.  
캐시 효율을 높이기 위해서는 적절한 캐시 정책과 캐시 저장 기간 등을 설정을 활용하여  
적중률을 높일 수 있다.  

오늘날에는 적중률이 40%만 돼도 괜찮은 적중률이라고 본다.


### 재검사
캐시된 리소스가 만료되어 새로운 요청이 들어왔을 때 해당 리소스가 유효한지 검사하고  
필요한 경우 서버로부터 새로운 버전을 가져오는 과정이다.  

캐시를 사용하면 웹 페이지 로딩 속도를 높일 수 있지만  
만약 만료된 캐시 리소스를 사용하게 되면 오래된 웹 페이지를 보여줄 수 있다는 문제가 발생한다.  
이러한 문제를 방지하기 위해 캐시 재검사를 수행한다.

![캐시 처리 플로우 차트](https://blog.kakaocdn.net/dn/bW9OZV/btqVCceI8J9/f5xiN4xMqbmm1IV68b4BBK/img.png)

캐시 리소스를 확인하기 위해 HTTP에서 몇가지 도구를 제공하는데  
가장 많이 사용되는 것은 If-Modified-Since이다.  
서버에게 보내는 GET 요청에 이 헤더를 추가하게 되면  
캐시된 시간 이후에 변경 내용이 있는 경우만 사본을 보내달라는 의미가 된다.

#### 재검사 적중
서버에 변경된 내용이 없다면 클라이언트에게 HTTP 304 Not Modified 응답을 보낸다.

#### 재검사 부적중
서버와 캐시서버의 객체가 다르다면 서버는 콘텐츠 전체와 함께 HTTP 200 OK 응답을 보낸다.

#### 객체 삭제
서버 객체가 삭제되었다면 404 Not Found 응답을 보내고 캐시서버는 사본을 삭제한다.


### 캐시 처리 단계
HTTP GET 메시지 하나를 처리하는 기본적인 캐시 처리 절차 7단계이다.  

1. 요청 받기 :  
   캐시는 네트워크로 부터 도착한 요청 메시지를 읽는다.
2. 파싱 :  
   캐시는 메시지를 파싱하여 URL과 헤더들을 추출한다.
3. 검색 :  
   캐시는 로컬 복사본이 있는지 검사하고, 사본이 없다면 사본을 받아와 로컬에 저장한다.
4. 신선도 검사 :  
   캐시는 캐시된 사본이 충분히 신선한지 검사하고 신선하지 않다면 서버에 변경사항이 있는지 확인한다.
5. 응답 생성 :  
   캐시는 새로운 헤더와 캐시된 본문으로 응답 메시지를 만든다.
6. 발송 :  
   캐시는 네트워크를 통해 응답을 클라이언트에게 돌려준다.
7. 로깅 :  
   선택적으로 캐시는 로그파일에 트랜잭션에 대해 서술한 로그 하나를 남긴다.


### 캐시 포톨로지
캐시를 구성하는 요소들과 그들 간의 관계를 설명하는 모델이다.  

#### 클라이언트
캐시를 사용하는 사용자나 애플리케이션이다.

#### 오리진 서버
웹 페이지나 리소스를 제공하는 서버이다.  
캐시 서버는 필요에 따라 오리진 서버에 요청을 보내 새로운 리소스를 받아온다.  

#### 캐시 서버
오리진 서버로부터 받은 리소스를 저장하고, 클라이언트에게 캐시된 리소스를 제공한다.

#### 게이트웨이
클라이언트와 오리진 서버 사이에서 작동하는 중개 서버이다.  
보안, 프로토콜 변환 등의 기능을 수행한다.

#### 프락시
클라이언트와 오리진 서버 가이에서 작동하며, 캐시 서버와 비슷한 역할을 수행하지만  
주로 보안, 로드 밸런싱, 콘텐츠 필터링 등의 기능을 수행한다.


### 캐시의 문제점 
메모리나 디스크 공간을 사용하기 때문에 캐시에 저장된 데이터를 사용하지 않는 경우에는  
오히려 자원이 낭비된다고 볼 수 있다.  
그리고 웹 페이지를 빠르게 보여줄 수는 있지만 최신 데이터가 아닌 이미 받아져 있는  
데이터를 가져와 보여주는 것이기 때문에 페이지가 최신 정보와 다를 수 있다는 문제가 있을 수 있다.  

이를 해결하기 위해서는 다양한 방법이 있다.

#### 캐시 만료 시간 설정하기
캐시에 저장된 데이터를 일정 시간이 지나면 자동으로 삭제되도록 만료 시간을 설정하여    
캐시된 데이터가 오래된 정보를 보여주는 문제를 해결할 수 있다.

#### 캐시 무효화
캐시된 데이터가 변경되었을 때 해당 데이터를 자동으로 삭제하는 등  
캐시된 데이터가 서버와 일치하지 않으면 수동으로 캐시를 삭제하거나  
캐시를 자동으로 무효화하는 기능을 추가하여 문제를 해결한다.

#### 캐시 제어 기능 추가
캐시 제어 기능을 추가하여 필요한 경우 캐시를 일시적으로 사용하지 않도록 하거나  
캐시에 저장할 데이터를 선택적으로 지정하면  
적절한 상황에 캐시를 사용하면서 캐시에 저장되는 데이터들을 적극적으로 관리할 수 있다.

#### 캐시 적중률 모니터링
캐시 적중률을 모니터링 하며 적절한 시기에 캠시를 삭제하거나 갱신하면  
캐시가 자원을 낭비하지 않고, 최신 정보를 제공할 수 있다.

#### 캐시 대안 사용
데이터베이스 쿼리 결과를 캐시하는 대신에  
인메모리 데이터베이스를 사용하여 빠르게 데이터를 조회하는 것처럼  
적절한 캐시 대안을 사용하여 문제를 해결할 수 있다.


### 참고
[[IT]캐시란?Cache is Cash](https://zangzangs.tistory.com/110)
