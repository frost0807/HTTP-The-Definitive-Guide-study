-----

14. 보안 HTTP

-----

디지털 암호화를 이용해 도청이나 위조로부터 HTTP 트랜잭션을 안전하게 보호하는 더 복잡하고 적극적인 기술을 제시한다.  

### HTTP의 보안
HTTP는 데이터 전송을 위한 프로토콜이기 때문에 데이터의 기밀성, 무결성, 인증 등과 같은 보안적인 측면에 취약하다.  
이러한 취약성으로 인해 데이터를 전송할 때 보안 문제가 발생할 수 있다.  

때문에 HTTP의 보안을 강화하기 위해선 HTTP와 디지털 암호화 기술을 결합해야 한다.

### HTTPS
HTTPS는 HTTP의 보안버전으로 가장 인기 있는 방식이며 모든 주류 브라우저와 서버에서 지원한다.
SSL 또는 TLS 프로토콜을 사용하여 데이터를 암호화하고 인증한다.  

HTTPS를 사용할 때 모든 HTTP 요청과 응답 데이터는 네트워크로 보내지기 전에 암호화 된다.  
HTTP의 하부에 전송 레벨 암호 보안 계층인 SSL 혹은 TLS를 제공함으로써 동작한다.  

<img src="https://images.velog.io/images/leeinae/post/a0fd2526-03ba-4d71-ae2b-fce058edf362/TCP%20%EA%B3%84%EC%B8%B5.png" width="400" height="250">

#### HTTPS 동작방식
1. 클라이언트가 HTTPS 프로토콜을 사용하여 서버에 접속한다.
2. 서버는 클라이언트에게 공개키(Public Key)를 전송한다.
3. 클라이언트는 서버의 공개키를 사용하여 세션 키(Session Key)를 암호화하여 서버로 전송한다.
4. 서버는 자신의 개인키(Private Key)를 사용하여 세션 키를 복호화한다.
5. 클라이언트와 서버는 서로 세션 키를 공유하고, 이 키를 사용하여 데이터를 암호화하여 전송한다.


### 디지털 암호학
#### 암호
메시지를 인코딩하는 어떤 특정한 방법과 나중에 그 비밀 메시지를 디코딩하는 방법이다.  
인코딩되기 전의 원본 메시지는 흔히 텍스트 혹은 평문이라고 불리고, 암호가 적용되어 코딩된 메시지는 보통 암호문이라고 불린다.  

<img src="https://raonctf.com/static/essential/images/crypto/crypto_cryptography_02.jpg" width="450" height="250">

#### 키
코드 알고리즘과 기계가 적의 손에 들어갈 수 있기 때문에 누군가 기계를 훔치더라도 올바른 다이얼 설정이 없이는  
디코더가 동작할 수 없는데, 이러한 암호 매개변수를 키라고 부른다.  
인코더들은 서로 다른 키 값을 갖고 있기 때문에 각각 다르게 동작한다.  
오늘날 거의 대부분의 암호 알고리즘은 키를 사용한다.  

### 대칭키 암호법
인코딩과 디코딩에 같은 키를 사용하는 알고리즘이다.  
발송자는 공유된 비밀 키를 암호화하고 그 결과인 암호문을 수신자에게 발송하기 위해 사용한다.  
수신자 역시 암호문을 받은 뒤 같은 공유키를 사용하여 원래의 평문을 복원한다.  

<img src="https://raonctf.com/static/essential/images/crypto/crypto_symmetric_key_01.jpg" width="450" height="250">

대칭키 알고리즘으로는 DES, Triple-DES, RC2, RC4등이 있다.

### 공개키 암호법
비밀 메시지를 전달하는 수백만 대의 컴퓨터를 쉽게 만들 수 있는 시스템이다.
호스트의 메시지를 디코딩하기 위한 키 하나와 그 호스트의 메시지를 디코딩하기 위한것 총 두 개의 비대칭 키를 사용한다.  
인코딩 키가 모두를 위해 공개되어 있긴 하지만 호스트만이 개인 디코딩 키를 알고있다.

RSA는 공개키 암호화 방식 중 하나로 전자상거래, 인터넷뱅킹, 전자서명 등에 사용된다.  
대칭키 암호화 방식보다 보안성이 더 강화되어 있기는 하지만  
대칭키 암호화 방식보다 처리 속도가 느리기 때문에 대용량 데이터의 암호화 및 복호화에는 적합하지 않다.  

### 디지털 서명
전자 문서의 진위성을 보장하기 위해 사용되는 기술 중 하나로 공개키 암호화 방식을 사용한다.  
누가 메시지를 썼는지 알려주고 그 메시지가 위조되지 않았음을 증명하기 위해 메시지에 서명을 하도록 하는 데에 이용될 수 있다.  
문서의 위조나 변조를 방지하고, 문서 처리의 효율성을 높일 수 있기 때문에  
전자상거래, 인터넷뱅킹, 전자 문서 관리 등 다양한 분야에서 사용된다.  

### 디지털 인증서
공개키 암호화 방식에서 사용되는 인증 수단 중 하나로  
신뢰할 수 있는 기관으로부터 보증 받은 사용자나 회사에 대한 정보를 담고 있다.  
통신의 안정성과 신뢰성을 보장하고, 전자적인 트랜잭션 처리를 효율적으로 수행할 수 있기 때문에  
인터넷뱅킹, 전자상거래, 안전한 메일 전송 등 다양한 분야에서 사용된다.  

-----

15. 엔터티와 인코딩

-----

HTTP는 아래와 같은 것들을 보장한다.  
- 객체를 올바르게 식별(Content-Type 미디어 포맷 또는 Content-Langugage헤더를 이용)하여 브라우저나  
  다른 클라이언트가 콘텐츠를 바르게 처리할 수 있게 한다.
- 객체는 올바르게 압축이 풀릴 것이다.(Content-Length와 Content-Encoding헤더)
- 객체는 항상 최신이다.(엔터티 검사기와 캐시 만료 제어)
- 사용자의 요구 만족할 것이다.(내용 협상을 위한 Accept 헤더 기반)
- 네트워크 사이를 빠르고 효율적으로 이동할 것이다.(범위 요청, 델타 인코딩, 그외 데이터압축)
- 조작되지 않고 온전하게 도착할 것이다.(전송 인코딩 헤더와 Content-MD5 체크섬 이용)

이것들을 가능하게 하기 위해서 HTTP는 콘텐츠를 나르기 위한 잘 라벨링된 엔터티를 사용한다.

### 엔터티
HTTP 메시지를 인터넷 운송 시스템의 컨테이너라고 하면, HTTP 엔터티는 메시지의 실질적인 화물이다.
HTTP 요청 메시지의 엔터티는 일반적으로 POST 또는 PUT 요청과 함께 전송되는 데이터를 나타내고,  
HTTP 응답 메시지의 엔터티는 서버가 클라이언트에게 전송하는 데이터를 나타낸다. 

HTTP가 일반적으로 TCP/IP와 같이 신뢰할 만한 전송 프로토콜 위에서 구현되지만,  
여러가지 이유로 메시지의 일부분이 전송 중에 변형되는 일이 일어난다.  
이러한 변경을 감지하기 위해 송신자는 데이터에 대한 체크섬을 생성할 수 있고  
수신자는 그 체크섬으로 기본적인 검사를 할 수 있다.

#### HTTP/1.1의 10가지 주요 엔터티 헤더 필드
- Content-Type: 엔터티에 의해 전달된 객체의 종류
- Content-Length: 전달되는 메시지의 길이나 크기
- Content-Language: 전달되는 객체와 가장 잘 대응되는 자연어
- Content-Encoding: 객체 데이터에 대해 행해진 변형(압축 등)
- Content-Location: 요청 시점을 기준으로, 객체의 또 다른 위치
- Content-Range: 부분 엔터티라면, 이 헤더는 이 엔터티가 전체에서 어느 부분에 해당하는지 정의
- Content-MD5: 엔터티 본문의 콘텐츠에 대한 체크섬
- Last-Modified: 서버에서 이 콘텐츠가 생성 혹은 수정된 날
- Expires: 이 엔터티 데이터가 더 이상 신선하지 않은 것으로 간주되기 시작하는 날짜와 시각
- Allow: 이 리소스에 대해 어떤 요청 메서드가 허용 되는지
- ETag: 이 인스턴스에 대한 고유한 검사기
- Cache-Control: 어떻게 이 문서가 캐시될 수 있는지에 대한 지시자

#### 엔터티 본문
요청을 보낼 때 서버에 보내는 데이터, 또는 서버에서 응답으로 클라이언트에게 전송하는 데이터를 말한다.  
HTTP 메시지의 본문에 포함되며, 요청과 응답 모두에 존재할 수 있다.  
프로토콜에서 데이터를 전송하는 중요한 요소 중 하나로 가공되지 않은 데이터만을 담고 있다.  


### 미디어 타입과 차셋
미디어 타입은 인터넷에서 전송되는 문서와 같은 미디어 유형을 식별하는 데 사용되는 문자열 식별자이다.  
주로 HTTP 요청 및 응답 헤더에 사용되며, MIME 형식으로 나타낸다.
차셋은 문자열 인코딩을 정희하는 데 사용되는 문자 집합이다.  
HTTP 응답 헤더에서 문자셋은 미디어 타입 뒤에 세미콜론으로 구분되어 나타난다.  

따라서, 미디어 타입과 문자셋은 인터넷에서 데이터를 전송하는 데 사용되는 중요한 개념이다.

- 텍스트 매체를 위한 문자 인코딩
- 멀티파트 미디어 타입
- 멀티파트 폼 제출
- 멀티파트 범위 응답


### 콘텐츠 인코딩
인터넷에서 전송되는 데이터의 압축 및 암호화를 처리하는 기술이다.  
인터넷에서 데이터를 전송할 때 데이터의 크기를 줄이고 전송 속도를 향상시키기 위해 사용되는데  
HTTP 애플리케이션은 때때로 콘텐츠를 보내기 전에 인코딩을 하려고 한다.  
콘텐츠 인코딩이 끝나면 엔터티 본문에 담아 수신자에게 보낸다.

#### 콘텐츠 인코딩 과정
1. 웹 서버가 원본 Content-Type과 Content-Length 헤더를 수반한 원본 응답 메시지를 생성한다.
2. 콘텐츠 인코딩 서버가 인코딩된 메시지를 생성하고 Content-Encoding 헤더를 인코딩된 메시지에 추가하여  
   받는 쪽에서 디코딩이 가능하도록 한다. (Content-Length는 다르다.)
3. 수신 측 프로그램은 인코딩된 메시지를 받아서 디코딩하고 원본을 얻는다.

#### 콘텐츠 인코딩 유형
HTTP는 몇 가지 표준 콘텐츠 인코딩 유형을 정의하고 확장 인코딩으로 인코딩을 추가하는 것도 허용한다.  
인코딩 알고리즘에 고유한 토큰을 할당하는 IANA를 통해 표준화된다.

- gizp
- compress
- deflate
- identity

이중 gzip은 일반적으로 가장 효율적이고 가장 널리 쓰이는 압축 알고리즘이다.  


### 전송 인코딩과 청크 인코딩
전송 인코딩은 HTTP 메시지의 바디를 인코딩하는 방식을 나타내며, 인코딩된 데이터를 전송하는 데 사용된다.  
청크 인코딩은 전송 인코딩의 가장 일반적인 유형으로 데이터를 일정한 크기의 청크로 나누고,  
각 청크의 크기와 함께 전송하는 방식이다.  
이러한 방식은 미리 데이터의 크기를 알 수 없거나 큰 파일을 전송할 때 유용하다.




일반적으로 HTTP가 TCP/IP와 같이 신뢰할 만한 전송 프로토콜 위에서 구현됨에도 불구하고  
여러 가지 이유로 메시지의 일부분이 전송 중 변형되는 일이 일어난다.  






