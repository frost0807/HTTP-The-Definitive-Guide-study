-----

3. HTTP 메시지

-----
### 메시지의 흐름
**HTTP 메시지**란 HTTP 애플리케이션 간에 주고받은 데이터의 블록들을 말한다.  
메시지가 원 서버로 향하는 것은 **인바운드**로 이동하는 것이고,  
메시지가 사용자 에이전트로 돌아오는 것은 **아웃바운드**로 이동한다.  
여기서 인바운드와 아웃바운드는 트랜잭션의 방향을 표현하는 것이다.  

모든 메시지는 무조건 다운스트림으로 흐르는데  
클라이언트(발신자) → 서버(수신자)로 다운스트림이거나  
서버(발신자) -> 클라이언트(수신자)로 다운스트림 된다.
![다운스트림 이미지](https://velog.velcdn.com/images/chldppwls12/post/cf7a5ada-83cf-405f-a241-1d9beffba59b/image.png)


### 메시지의 구분
메시지는 시작줄, 헤더 블록, 본문으로 이루어져 있다.
#### 시작줄
이 메시지가 어떤 메시지인지 서술한다.
#### 헤더 블록
이 메시지의 속성을 나타낸다.
#### 본문
데이터를 담는 부분으로 데이터가 없을 수도 있다.


### 메시지 문법
#### 요청 메시지
시작줄 - 메서드, 요청URL, 버전  
헤더  
본문
#### 응답 메시지
시작줄 - 버전, 상태 코드, 사유 구절  
헤더  
본문


### 메서드
사이트나 서버에 따라 구현 가능한 메서드는 다를 수 있다.  

안전한 메서드 즉 요청의 결과로 서버에 아무일도 일어나지 않는 메서드로는 GET과 HEAD가 있다.  
HTTP 프로토콜에 정의되어 있지는 않지만 일부 웹 서버에서 지원하는 HTTP 메서드인 확장 메서드는  
LOCK, MIKCOL, COPY, MOVE 등이 있다.
#### GET
가장 흔하게 사용되는 메서드이다.  
주로 서버에게 리소스를 요청하기 위해 사용한다.  
#### HEAD
GET과 비슷하지만 응답으로 헤더만 돌려준다는 점에서 다르다.  
본문은 반환되지 않는다.  
리소스를 가져오지 않고 어떤것인지 알아내거나, 개체의 유무나,  
리소스 변경이 있는지 확인하기 위해 사용한다.  
#### PUT
서버에 문서를 새로 작성하거나 이미 존재하는 경우 교체한다.  
#### POST
서버에 입력 데이터를 전송한다.  
서버는 전송받은 데이터들을 모아 필요로 하는곳에 보낸다.
#### TRACE
클라이언트에게 자신의 요청이 서버에 도달했을 때 어떻게 보이게 되는지 알려준다.  
클라이언트와 서버 사이에서 Loop back Test를 진행할 수 있게 도와준다.  
#### OPTIONS
웹 서버에게 여러 가지 종류의 지원 범위에 대해 물어본다.
#### DELETE
서버에게 요청 URL로 지정한 리소스를 삭제할 것을 요청한다.


### 상태 코드
HTTP 프로토콜에서 가장 중요한 요소 중 하나로 클라이언트와 서버 간의 통신에서 매우 중요한 역할을 한다.  
3자리 숫자로 구성된 코드로 서버 응답의 성공 여부를 클라이언트에게 제공한다.  
첫 번째 자리는 상태 코드의 범주를 나타내고, 두 번째와 세 번째는 상세한 상태 코드를 나타낸다.  

상태 코드는 크게 다섯 가지로 구분할 수 있다.  

#### 1xx : 정보성 상태 코드
요청을 받았으며, 작업이 계속됨을 나타낸다.
#### 2xx : 성공 상태 코드
요청이 성공적으로 처리되었음을 나타낸다.
#### 3xx : 리다이렉션 상태 코드
추가 조치가 필요함을 나타내며, 브라우저를 다른 위치로 리다이렉션한다.
#### 4xx : 클라이언트 에러 상태 코드
클라이언트 오류를 나타내며, 잘못된 요청이나 권한 없는 요청 등이 있다.
#### 5xx : 서버 에러 상태 코드
서버 오류를 나타내며, 서버에서 요청을 처리하지 못한 경우이다.

#### 자주 사용되는 상태 코드
* 200 OK :  
  요청이 성공적으로 처리되었음을 나타냅니다.
* 201 Created :  
  요청이 성공적으로 처리되어 새로운 리소스가 생성되었음을 나타냅니다.
* 400 Bad Request :  
  클라이언트의 요청이 잘못되었음을 나타냅니다.
* 401 Unauthorized :  
  클라이언트가 인증되지 않았으며, 인증이 필요함을 나타냅니다.
* 404 Not Found :  
  요청한 리소스가 서버에서 찾을 수 없음을 나타냅니다.
* 500 Internal Server Error :  
  서버에서 요청을 처리할 수 없는 오류가 발생했음을 나타냅니다.

#### 장점
* 요청 처리 상태를 파악할 수 있다.
* 오류 처리 및 디버깅이 편리하다.
* 자동화된 처리가 가능하다.


### 헤더
HTTP 요청 및 응답 메시지에 추가 정보를 더하는 블록으로  
요청 및 응답 메시지를 처리하고 분석하는 데 필수적인 정보를 제공하며,  
클라이언트와 서버 간의 효율적인 통신을 지원한다.  
기본적으로 이름/값 쌍의 목록으로 이루어져 있다.
#### 일반 헤더
클라이언트와 서버 모두 사용하는 헤더로, 캐시와 연결 관리, 메시지의 압축 및 인코딩 등의 정보를 포함한다.
#### 요청 헤더
요청 메시지에서 사용되는 헤더로, 요청 라인, 클라이언트 및 서버 정보, 쿠키 등의 정보를 포함한다.
#### 응답 헤더
응답 메시지에서 사용되는 헤더로, 서버 정보, 캐시 제어, 압축 및 인코딩 정보 등의 정보를 포함한다.
#### 엔티티 헤더
요청 및 응답 메시지의 엔티티에 대한 정보를 포함하는 헤더로, 엔티티의 크기, MIME 타입, 인코딩 정보 등을 포함한다.
#### 확장 헤더
요청 및 응답 메시지에 추가적인 정보를 제공하기 위해 사용되는 헤더로, 사용자 정의 헤더 등을 포함한다.


-----

4. 커넥션 관리

-----
### TCP 커넥션
![TCP 커넥션 예시](https://1670689587-files.gitbook.io/~/files/v0/b/gitbook-legacy-files/o/assets%2F-M2sVIqL1jLZHEcbDW41%2F-M2sVS0EyNvuclZo64jT%2F-M2sVWjapzx3PzXnRrEz%2Ftcp-connection_1.png?generation=1584717273029164&alt=media)
인터넷 프로토콜 스위트의 일부로, 네트워크 상에서 양 끝단(클라이언트와 서버)간에 신뢰성 있고,  
순서대로 전송되는 데이터 스트림을 제공하는 연결지향 프로토콜이다.

### TCP로 인한 HTTP 트랜잭션 지연
TCP 네트워크 지연은 하드웨어의 성능, 네트워크와 서버의 전송 속도, 요청과 응답 메시지의 크기,  
클라이언트와 서버 간의 거리, TCP 프로토콜의 기술적인 복잡성 등에 따라 크게 달라진다.
* TCP 커넥션 핸드셰이크 설정
* TCP 느린 시작
* 네이글 알고리즘
* 확인 응답 지연 알고리즘
* TIME_WAIT 지연과 포트 고갈


### HTTP 커넥션 관리
#### 병렬 커넥션
#### 지속 커넥션
#### 파이프라인 커넥션



